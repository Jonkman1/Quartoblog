{
  "hash": "f993bbcd28c268a14549a54dc53ee79b",
  "result": {
    "markdown": "---\ntitle: \"Sankey diagrams and how to create\"\nsubtitle: \"NSC-R Tidy Tuesday March 2022\"\nauthor: Tim Verlaan\ndate: \"2022-03-09\"\nformat:\n    html \n---\n\n\n## Introduction\n\nIn this meeting, Tim Verlaan explains what Sankey diagrams are, and how they can be created in R [@verlaan_nsc-rn_2022]\n\n## Get started\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyr)\nlibrary(dplyr)\nlibrary(readr)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrelig_income\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 18 x 11\n   religion      `<$10k` $10-2~1 $20-3~2 $30-4~3 $40-5~4 $50-7~5 $75-1~6 $100-~7\n   <chr>           <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>\n 1 Agnostic           27      34      60      81      76     137     122     109\n 2 Atheist            12      27      37      52      35      70      73      59\n 3 Buddhist           27      21      30      34      33      58      62      39\n 4 Catholic          418     617     732     670     638    1116     949     792\n 5 Donâ€™t know/r~      15      14      15      11      10      35      21      17\n 6 Evangelical ~     575     869    1064     982     881    1486     949     723\n 7 Hindu               1       9       7       9      11      34      47      48\n 8 Historically~     228     244     236     238     197     223     131      81\n 9 Jehovah's Wi~      20      27      24      24      21      30      15      11\n10 Jewish             19      19      25      25      30      95      69      87\n11 Mainline Prot     289     495     619     655     651    1107     939     753\n12 Mormon             29      40      48      51      56     112      85      49\n13 Muslim              6       7       9      10       9      23      16       8\n14 Orthodox           13      17      23      32      32      47      38      42\n15 Other Christ~       9       7      11      13      13      14      18      14\n16 Other Faiths       20      33      40      46      49      63      46      40\n17 Other World ~       5       2       3       4       2       7       3       4\n18 Unaffiliated      217     299     374     365     341     528     407     321\n# ... with 2 more variables: `>150k` <dbl>, `Don't know/refused` <dbl>, and\n#   abbreviated variable names 1: `$10-20k`, 2: `$20-30k`, 3: `$30-40k`,\n#   4: `$40-50k`, 5: `$50-75k`, 6: `$75-100k`, 7: `$100-150k`\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n?pivot_longer\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npivot_longer(relig_income, !religion)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 180 x 3\n   religion name               value\n   <chr>    <chr>              <dbl>\n 1 Agnostic <$10k                 27\n 2 Agnostic $10-20k               34\n 3 Agnostic $20-30k               60\n 4 Agnostic $30-40k               81\n 5 Agnostic $40-50k               76\n 6 Agnostic $50-75k              137\n 7 Agnostic $75-100k             122\n 8 Agnostic $100-150k            109\n 9 Agnostic >150k                 84\n10 Agnostic Don't know/refused    96\n# ... with 170 more rows\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- relig_income |>\n  pivot_longer(!religion, names_to = 'income', values_to = 'count')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbillboard\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 317 x 79\n   artist track date.ent~1   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8   wk9\n   <chr>  <chr> <date>     <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>\n 1 2 Pac  Baby~ 2000-02-26    87    82    72    77    87    94    99    NA    NA\n 2 2Ge+h~ The ~ 2000-09-02    91    87    92    NA    NA    NA    NA    NA    NA\n 3 3 Doo~ Kryp~ 2000-04-08    81    70    68    67    66    57    54    53    51\n 4 3 Doo~ Loser 2000-10-21    76    76    72    69    67    65    55    59    62\n 5 504 B~ Wobb~ 2000-04-15    57    34    25    17    17    31    36    49    53\n 6 98^0   Give~ 2000-08-19    51    39    34    26    26    19     2     2     3\n 7 A*Tee~ Danc~ 2000-07-08    97    97    96    95   100    NA    NA    NA    NA\n 8 Aaliy~ I Do~ 2000-01-29    84    62    51    41    38    35    35    38    38\n 9 Aaliy~ Try ~ 2000-03-18    59    53    38    28    21    18    16    14    12\n10 Adams~ Open~ 2000-08-26    76    76    74    69    68    67    61    58    57\n# ... with 307 more rows, 67 more variables: wk10 <dbl>, wk11 <dbl>,\n#   wk12 <dbl>, wk13 <dbl>, wk14 <dbl>, wk15 <dbl>, wk16 <dbl>, wk17 <dbl>,\n#   wk18 <dbl>, wk19 <dbl>, wk20 <dbl>, wk21 <dbl>, wk22 <dbl>, wk23 <dbl>,\n#   wk24 <dbl>, wk25 <dbl>, wk26 <dbl>, wk27 <dbl>, wk28 <dbl>, wk29 <dbl>,\n#   wk30 <dbl>, wk31 <dbl>, wk32 <dbl>, wk33 <dbl>, wk34 <dbl>, wk35 <dbl>,\n#   wk36 <dbl>, wk37 <dbl>, wk38 <dbl>, wk39 <dbl>, wk40 <dbl>, wk41 <dbl>,\n#   wk42 <dbl>, wk43 <dbl>, wk44 <dbl>, wk45 <dbl>, wk46 <dbl>, wk47 <dbl>, ...\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbillboard |>\n  pivot_longer(\n    cols = starts_with('wk'),\n    values_drop_na = TRUE,\n    names_to = \"week\",\n    values_to = 'rank',\n    names_prefix = \"wk\",\n    names_transform = list(week = as.integer)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5,307 x 5\n   artist  track                   date.entered  week  rank\n   <chr>   <chr>                   <date>       <int> <dbl>\n 1 2 Pac   Baby Don't Cry (Keep... 2000-02-26       1    87\n 2 2 Pac   Baby Don't Cry (Keep... 2000-02-26       2    82\n 3 2 Pac   Baby Don't Cry (Keep... 2000-02-26       3    72\n 4 2 Pac   Baby Don't Cry (Keep... 2000-02-26       4    77\n 5 2 Pac   Baby Don't Cry (Keep... 2000-02-26       5    87\n 6 2 Pac   Baby Don't Cry (Keep... 2000-02-26       6    94\n 7 2 Pac   Baby Don't Cry (Keep... 2000-02-26       7    99\n 8 2Ge+her The Hardest Part Of ... 2000-09-02       1    91\n 9 2Ge+her The Hardest Part Of ... 2000-09-02       2    87\n10 2Ge+her The Hardest Part Of ... 2000-09-02       3    92\n# ... with 5,297 more rows\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"remotes\")\n#remotes::install_github(\"davidsjoberg/ggsankey\")\nlibrary(ggsankey)\nlibrary(ggplot2)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n?mtcars\n\ndf <- mtcars |>\n  make_long(cyl, vs, am, gear, carb)\n```\n:::\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nggplot(df, aes(x = x,\n               node = node,\n               next_x = next_x,\n               next_node = next_node,\n               fill = factor(node),\n               label = node)) +\n  geom_sankey() +\n  geom_sankey_label() \n```\n\n::: {.cell-output-display}\n![Sankey graph](04_TT_202203_files/figure-html/Sankey-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf1 <- mtcars |>\n  select(cyl, vs, am, gear, carb) |>\n  pivot_longer(everything()) |>\n  mutate(next_x = lead(.data$name),\n         next_node = lead(.data$value)\n  )\n```\n:::\n\n\n# References\n",
    "supporting": [
      "04_TT_202203_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}