{
  "hash": "3d0627b175faf4aac5afab2a37d2d424",
  "result": {
    "markdown": "---\ntitle: \"Researching Spanish soccer data\"\nauthor: \"Wim Bernasco\"\ndate: \"2022-03-22\"\ncategories: [exploration, visualization]\nimage: \"Screenshot.png\"\n---\n\n\n\n## Introduction\n\nSports in general and football (soccer) in particular provides a sheer endless source of open data that can be explored at various levels (player, team, match, competition) and from various perspectives. In this workshop Wim Bernasco uses open data about football borrowed from a GitHub repository maintained by James Curley (James P. Curley (2016). More information [here](https://nscrweb.netlify.app/posts/2022-03-22-nsc-r-tidy-tuesday/) [@bernasco_nsc-r_2022]\n\n\\[1\\^\\]Wim Bernasco, Franziska Yasrebi-de Kom provided fertile suggestions on code and comments\n\n## Packages and data\n\nInstall packages, the admin required to get going\n\n    #install.packages('tidyverse')\n        #install.packages('lubridate')\n        #install.packages('devtools')\n        #library(devtools)\n        #install_github(\"jalapic/engsoccerdata\")\n\nLoad libraries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(engsoccerdata)\n```\n:::\n\n\n`engsoccerdata` is a package that includes data. Let us fist see what data are included (list the data in this package).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(package=\"engsoccerdata\")  \n```\n:::\n\n\nIf you like sports data, [checkout](https://statsbomb.com/) for free datasets\n\n## Exploration\n\nWhat type of dataset is `spain`? I hope a data.frame.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain |> class()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"data.frame\"\n```\n:::\n:::\n\n\nGreat, it is a data.frame\n\nWhat are the names of the variables. I hope they are self-explanatory.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain |> names()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"Date\"    \"Season\"  \"home\"    \"visitor\" \"HT\"      \"FT\"      \"hgoal\"  \n [8] \"vgoal\"   \"tier\"    \"round\"   \"group\"   \"notes\"  \n```\n:::\n:::\n\n\nLet us peek into the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain |> glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 23,915\nColumns: 12\n$ Date    <chr> \"1929-02-10\", \"1929-02-10\", \"1929-02-10\", \"1929-02-10\", \"1929-~\n$ Season  <dbl> 1928, 1928, 1928, 1928, 1928, 1928, 1928, 1928, 1928, 1928, 19~\n$ home    <chr> \"Arenas de Getxo\", \"Espanyol Barcelona\", \"Real Madrid\", \"Real ~\n$ visitor <chr> \"Atletico Madrid\", \"Real Union\", \"CE Europa\", \"Athletic Bilbao~\n$ HT      <chr> \"0-2\", \"1-0\", \"0-0\", \"1-1\", \"0-0\", \"0-1\", \"3-0\", \"0-3\", \"0-1\",~\n$ FT      <chr> \"2-3\", \"3-2\", \"5-0\", \"1-1\", \"0-2\", \"1-2\", \"9-0\", \"0-3\", \"3-1\",~\n$ hgoal   <dbl> 2, 3, 5, 1, 0, 1, 9, 0, 3, 5, 3, 3, 1, 0, 2, 1, 2, 3, 2, 2, 3,~\n$ vgoal   <dbl> 3, 2, 0, 1, 2, 2, 0, 3, 1, 2, 0, 1, 1, 4, 1, 2, 1, 0, 2, 0, 3,~\n$ tier    <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,~\n$ round   <chr> \"league\", \"league\", \"league\", \"league\", \"league\", \"league\", \"l~\n$ group   <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA~\n$ notes   <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA~\n```\n:::\n:::\n\n\nYou should see something like this:\n\n    # Rows: 25,435\n    # Columns: 12\n    # $ Date    <date> 1929-02-10, 1929-02-10, 1929-02-10, 1929-02-10, 1929-02-12, 1929-02-~\n    # $ Season  <dbl> 1928, 1928, 1928, 1928, 1928, 1928, 1928, 1928, 1928, 1928, 1928, 192~\n    # $ home    <chr> \"Arenas de Getxo\"\n\nThis is much more intuitive, but it only works interactively/ Try it out yourself, but do not include the `View` function in your script\n\n    spain |> View()\n\nAlternatively, a quick look at the first 10 rows.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain |> \n  select(Date, home, visitor, FT) |> \n  head(n = 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         Date               home            visitor  FT\n1  1929-02-10    Arenas de Getxo    Atletico Madrid 2-3\n2  1929-02-10 Espanyol Barcelona         Real Union 3-2\n3  1929-02-10        Real Madrid          CE Europa 5-0\n4  1929-02-10      Real Sociedad    Athletic Bilbao 1-1\n5  1929-02-12   Racing Santander       FC Barcelona 0-2\n6  1929-02-17       FC Barcelona        Real Madrid 1-2\n7  1929-02-17    Athletic Bilbao Espanyol Barcelona 9-0\n8  1929-02-17    Atletico Madrid      Real Sociedad 0-3\n9  1929-02-17         Real Union   Racing Santander 3-1\n10 1929-02-17          CE Europa    Arenas de Getxo 5-2\n```\n:::\n:::\n\n\nLet us look at frequencies of some variables.\n\nHow many teams?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain |> count(home)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                  home    n\n1           AD Almeria   34\n2             Albacete  135\n3      Arenas de Getxo   65\n4      Athletic Bilbao 1362\n5      Atletico Madrid 1288\n6      Atletico Tetuan   15\n7            Burgos CF  102\n8           CA Osasuna  639\n9             Cadiz CF  223\n10           CD Alaves  171\n11         CD Alcoyano   54\n12        CD Castellon  167\n13           CD Condal   15\n14          CD Leonesa   15\n15         CD Logrones  173\n16           CD Malaga  323\n17         CD Numancia   76\n18         CD Tenerife  247\n19           CE Europa   27\n20         CE Sabadell  213\n21          Celta Vigo  830\n22      CF Extremadura   40\n23          Cordoba CF  141\n24           CP Merida   40\n25 Deportivo La Coruna  746\n26            Elche CF  339\n27  Espanyol Barcelona 1294\n28        FC Barcelona 1362\n29           Getafe CF  228\n30           Gimnastic   58\n31          Granada CF  352\n32         Hercules CF  314\n33          Levante UD  201\n34           Malaga CF  285\n35       Pontevedra CF   90\n36    Racing Santander  713\n37      Rayo Vallecano  321\n38        RCD Mallorca  494\n39          Real Betis  845\n40         Real Burgos   57\n41           Real Jaen   45\n42         Real Madrid 1362\n43         Real Murcia  293\n44         Real Oviedo  596\n45       Real Sociedad 1132\n46          Real Union   36\n47     Real Valladolid  733\n48       Real Zaragoza  993\n49   Recreativo Huelva   93\n50       SD Compostela   80\n51            SD Eibar   38\n52          Sevilla FC 1185\n53      Sporting Gijon  710\n54          UD Almeria  114\n55       UD Las Palmas  529\n56        UD Salamanca  212\n57           UE Lleida   34\n58         Valencia CF 1313\n59       Villarreal CF  304\n60            Xerez CD   19\n```\n:::\n:::\n\n\nFrequencies of variable-combinations\n\nHow many times did team A host team B? (Results not shown here, `output=false`, because of length)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain |> count(home, visitor)\n```\n:::\n\n\nFrequencies of match outcomes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain |> count(hgoal, vgoal)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   hgoal vgoal    n\n1      0     0 1811\n2      0     1 1320\n3      0     2  742\n4      0     3  299\n5      0     4  117\n6      0     5   30\n7      0     6   12\n8      0     7    4\n9      0     8    4\n10     1     0 2815\n11     1     1 2570\n12     1     2 1168\n13     1     3  431\n14     1     4  155\n15     1     5   58\n16     1     6   11\n17     1     7    2\n18     1     8    1\n19     2     0 2039\n20     2     1 2228\n21     2     2 1035\n22     2     3  357\n23     2     4  135\n24     2     5   35\n25     2     6    6\n26     2     7    2\n27     2     8    2\n28     3     0 1196\n29     3     1 1262\n30     3     2  652\n31     3     3  218\n32     3     4   47\n33     3     5   14\n34     3     6    6\n35     3     8    1\n36     4     0  643\n37     4     1  669\n38     4     2  325\n39     4     3  127\n40     4     4   28\n41     4     5    8\n42     4     6    2\n43     4     7    1\n44     5     0  268\n45     5     1  288\n46     5     2  149\n47     5     3   47\n48     5     4   22\n49     5     5    2\n50     5     6    1\n51     6     0  110\n52     6     1  116\n53     6     2   67\n54     6     3   19\n55     6     4    7\n56     6     6    1\n57     7     0   54\n58     7     1   48\n59     7     2   23\n60     7     3   11\n61     7     4    1\n62     7     5    1\n63     8     0   21\n64     8     1   20\n65     8     2   10\n66     8     3    6\n67     9     0   12\n68     9     1    5\n69     9     2    2\n70     9     3    1\n71     9     4    1\n72     9     5    1\n73    10     0    3\n74    10     1    5\n75    10     2    1\n76    10     3    1\n77    11     1    1\n78    11     2    1\n79    12     1    1\n```\n:::\n:::\n\n\nSame, but using the combined FT variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain |> count(FT)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     FT    n\n1   0-0 1811\n2   0-1 1320\n3   0-2  742\n4   0-3  299\n5   0-4  117\n6   0-5   30\n7   0-6   12\n8   0-7    4\n9   0-8    4\n10  1-0 2815\n11  1-1 2570\n12  1-2 1168\n13  1-3  431\n14  1-4  155\n15  1-5   58\n16  1-6   11\n17  1-7    2\n18  1-8    1\n19 10-0    3\n20 10-1    5\n21 10-2    1\n22 10-3    1\n23 11-1    1\n24 11-2    1\n25 12-1    1\n26  2-0 2039\n27  2-1 2228\n28  2-2 1035\n29  2-3  357\n30  2-4  135\n31  2-5   35\n32  2-6    6\n33  2-7    2\n34  2-8    2\n35  3-0 1196\n36  3-1 1262\n37  3-2  652\n38  3-3  218\n39  3-4   47\n40  3-5   14\n41  3-6    6\n42  3-8    1\n43  4-0  643\n44  4-1  669\n45  4-2  325\n46  4-3  127\n47  4-4   28\n48  4-5    8\n49  4-6    2\n50  4-7    1\n51  5-0  268\n52  5-1  288\n53  5-2  149\n54  5-3   47\n55  5-4   22\n56  5-5    2\n57  5-6    1\n58  6-0  110\n59  6-1  116\n60  6-2   67\n61  6-3   19\n62  6-4    7\n63  6-6    1\n64  7-0   54\n65  7-1   48\n66  7-2   23\n67  7-3   11\n68  7-4    1\n69  7-5    1\n70  8-0   21\n71  8-1   20\n72  8-2   10\n73  8-3    6\n74  9-0   12\n75  9-1    5\n76  9-2    2\n77  9-3    1\n78  9-4    1\n79  9-5    1\n```\n:::\n:::\n\n\nFrequencies of a sum (total goals in match)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain |> count(hgoal + vgoal)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   hgoal + vgoal    n\n1              0 1811\n2              1 4135\n3              2 5351\n4              3 4891\n5              4 3488\n6              5 2131\n7              6 1146\n8              7  543\n9              8  237\n10             9  113\n11            10   42\n12            11   17\n13            12    5\n14            13    4\n15            14    1\n```\n:::\n:::\n\n\nFrequencies of function work as well (year of match date).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain |> count(year(Date))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   year(Date)   n\n1        1929 115\n2        1930  84\n3        1931  91\n4        1932  95\n5        1933 110\n6        1934  75\n7        1935 150\n8        1936  84\n9        1939  30\n10       1940 186\n11       1941 139\n12       1942 182\n13       1943 175\n14       1944 189\n15       1945 182\n16       1946 189\n17       1947 175\n18       1948 189\n19       1949 189\n20       1950 205\n21       1951 240\n22       1952 216\n23       1953 256\n24       1954 248\n25       1955 216\n26       1956 264\n27       1957 232\n28       1958 240\n29       1959 240\n30       1960 232\n31       1961 264\n32       1962 216\n33       1963 239\n34       1964 249\n35       1965 240\n36       1966 233\n37       1967 239\n38       1968 248\n39       1969 248\n40       1970 232\n41       1971 246\n42       1972 324\n43       1973 306\n44       1974 288\n45       1975 315\n46       1976 306\n47       1977 297\n48       1978 306\n49       1979 306\n50       1980 332\n51       1981 306\n52       1982 297\n53       1983 310\n54       1984 320\n55       1985 306\n56       1986 324\n57       1987 366\n58       1988 379\n59       1989 401\n60       1990 368\n61       1991 371\n62       1992 380\n63       1993 391\n64       1994 370\n65       1995 428\n66       1996 451\n67       1997 454\n68       1998 350\n69       1999 401\n70       2000 369\n71       2001 400\n72       2002 350\n73       2003 401\n74       2004 379\n75       2005 381\n76       2006 369\n77       2007 391\n78       2008 370\n79       2009 370\n80       2010 390\n81       2011 380\n82       2012 390\n83       2013 380\n84       2014 369\n85       2015 390\n86       2016 211\n```\n:::\n:::\n\n\nNote: this works because R knows that 'Date' is a date\n\nHow can you know that R knows? Either: (1) type 'spain %\\>% glimpse' and observe that the class of 'Date' is a <date>\\\n(2) type 'spain %\\>% pull(Date) %\\>% class()' to obtain that information (pull returns a single variable from a dataframe)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain |> pull(Date) |> class()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"character\"\n```\n:::\n:::\n\n\nWhat is this 'round' variable?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain |> count(round)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   round     n\n1 league 23825\n2 phase2    90\n```\n:::\n:::\n\n\nApparently 90 matches ('phase2') are not regular La Liga matches. In subsequent analyses, we will not use these 90 matches. So we create a new dataframe excluding these 90 matches.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain_league <-\n  spain |>\n  filter(round==\"league\")\n```\n:::\n\n\nWe will try to answer a couple of simple questions:\\\n1. Is it true that there are less goals today than in earlier days?\\\n2. Is the number of goals related to the season of the year?\\\n3. Is playing home really an advantage?\\\n4. If so, has this advantage changed over time?\n\n1.  Less goals today?\n\nKey variables, just to check we have the variables we need and they look OK. Just list the first 10 cases\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain_league |>\n  select(Date, home, visitor, hgoal, vgoal) |>\n  head(n=10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         Date               home            visitor hgoal vgoal\n1  1929-02-10    Arenas de Getxo    Atletico Madrid     2     3\n2  1929-02-10 Espanyol Barcelona         Real Union     3     2\n3  1929-02-10        Real Madrid          CE Europa     5     0\n4  1929-02-10      Real Sociedad    Athletic Bilbao     1     1\n5  1929-02-12   Racing Santander       FC Barcelona     0     2\n6  1929-02-17       FC Barcelona        Real Madrid     1     2\n7  1929-02-17    Athletic Bilbao Espanyol Barcelona     9     0\n8  1929-02-17    Atletico Madrid      Real Sociedad     0     3\n9  1929-02-17         Real Union   Racing Santander     3     1\n10 1929-02-17          CE Europa    Arenas de Getxo     5     2\n```\n:::\n:::\n\n\nSame, but this time a random sample of rows.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain_league |>\n  select(Date, home, visitor, hgoal, vgoal) |>\n  slice_sample(n=10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         Date               home             visitor hgoal vgoal\n1  1983-12-14       RCD Mallorca       Real Sociedad     2     1\n2  1949-02-20 Espanyol Barcelona         Real Madrid     3     2\n3  1988-10-16    Atletico Madrid  Espanyol Barcelona     6     1\n4  2015-02-20          Getafe CF  Espanyol Barcelona     2     1\n5  1980-05-04       UD Salamanca          Sevilla FC     2     1\n6  1957-12-29         Sevilla FC         Valencia CF     0     1\n7  2005-04-16      Real Sociedad Deportivo La Coruna     1     0\n8  1970-03-08         Granada CF        RCD Mallorca     1     1\n9  1954-09-12    Real Valladolid       Real Sociedad     1     0\n10 1951-11-04        Valencia CF          Sevilla FC     2     0\n```\n:::\n:::\n\n\nOnce more, number of goals in match\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain_league |> count(hgoal + vgoal)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   hgoal + vgoal    n\n1              0 1807\n2              1 4122\n3              2 5330\n4              3 4870\n5              4 3472\n6              5 2120\n7              6 1142\n8              7  543\n9              8  237\n10             9  113\n11            10   42\n12            11   17\n13            12    5\n14            13    4\n15            14    1\n```\n:::\n:::\n\n\nHow did the number of goals per match develop over time?\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nspain_league |>\n  # number of goals per match, and year of the match\n  mutate(goals = hgoal+vgoal,\n         year  = year(Date)\n  ) |>\n  ggplot() + \n  geom_point(aes(x=year, y=goals))\n```\n\n::: {.cell-output-display}\n![Year and goals](05_TT_202203_files/figure-html/year_goals-1.png){width=576}\n:::\n:::\n\n\nOeps, this was not what I had in mind. I need to aggregate first! The 'group_by' function does group the data per year, so that we can then use the `summarize` function to obtain the mean goals scored per match (`mean_goals_pm`) per year.\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nspain_league |>\n  mutate(goals = hgoal + vgoal,\n         year  = year(Date)\n  ) |>\n  group_by(year) |>\n  summarize(mean_goals_pm = mean(goals)) |>\n  ggplot() + \n  geom_line(aes(x=year, y=mean_goals_pm))\n```\n\n::: {.cell-output-display}\n![Goals grouped by year](05_TT_202203_files/figure-html/year_goals_groupby-1.png){width=576}\n:::\n:::\n\n\nYes, there were more goals back in the old days (before 1950).\n\nFunny pattern. What about England? Do we have the same variables (yes!)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nengland |> names()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"Date\"     \"Season\"   \"home\"     \"visitor\"  \"FT\"       \"hgoal\"   \n [7] \"vgoal\"    \"division\" \"tier\"     \"totgoal\"  \"goaldif\"  \"result\"  \n```\n:::\n:::\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nengland |>\n  # number of goals per match, and year of the match\n  mutate(goals = hgoal+vgoal,\n         year  = year(Date)\n  ) |>\n  group_by(year) |>\n  summarize(mean_goals_pm = mean(goals)) |>\n  ggplot() + \n  geom_line(aes(x=year, y=mean_goals_pm))\n```\n\n::: {.cell-output-display}\n![Mean goals grouped by year](05_TT_202203_files/figure-html/mean_goals_groupby-1.png){width=576}\n:::\n:::\n\n\nEngland is were the game was invented (they say), so they have a longer history going back to 1888. Let us now combine England and Spain.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain_series <-\n  spain_league |>\n  mutate(goals  = hgoal+vgoal,\n         year   = year(Date)\n  ) |>\n  group_by(year) |>\n  summarize(mean_goals_pm = mean(goals),\n            # Define a constant for Spain\n            country       = \"Spain\")\n```\n:::\n\n\nWhat des this look like? Do it yourself: `View(spain_series)`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nengland_series <-\n  england |>\n  # number of goals per match, and year of the match\n  mutate(goals  = hgoal+vgoal,\n         year   = year(Date)\n  ) |>\n  group_by(year) |>\n  summarize(mean_goals_pm = mean(goals),\n            # Define a constant for England\n            country       = \"England\")\n```\n:::\n\n\nStack both datasets on top of each other\n\n\n::: {.cell}\n\n```{.r .cell-code}\nseries <- bind_rows(spain_series, england_series)\n```\n:::\n\n\nTake a look yourself (note that England started 1888, Spain in 1929)\n\n    series |> \n      arrange(year, country) |> \n      View()\n      \n\nPlot development in Spain and England in the same graph\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nseries |>\n  ggplot() +\n  geom_line(aes(x=year, y=mean_goals_pm, color=country))\n```\n\n::: {.cell-output-display}\n![Developments in Spain and England](05_TT_202203_files/figure-html/spain_england-1.png){width=576}\n:::\n:::\n\n\nBack to Spain\n\n2.  Is the number of goals related to the season of the year? We use month of the year as a season indicator.\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nspain_league |>\n  # number of goals per match, and year of the match\n  mutate(goals = hgoal+vgoal,\n         month  = month(Date)\n  ) |>\n  group_by(month) |>\n  summarize(mean_goals_pm = mean(goals)) |>\n  ggplot() + \n  geom_point(aes(x=month, y=mean_goals_pm)) +\n  scale_x_continuous(breaks=1:12)\n```\n\n::: {.cell-output-display}\n![Goals related to the season](05_TT_202203_files/figure-html/goals_seasib-1.png){width=576}\n:::\n:::\n\n\nLet us check how many we have in summer (June-August, numbers of games)\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nspain_league |>\n  mutate(goals = hgoal+vgoal,\n         month  = month(Date)\n  ) |>\n  group_by(month) |>\n  # This is how we count nr of rows (matches) per month\n  summarize(number_of_matches = n()) |>\n  ggplot() + \n  geom_point(aes(x=month, y=number_of_matches)) +\n  # this gives us a scale nicely labeled 1..12\n  scale_x_continuous(breaks=1:12)\n```\n\n::: {.cell-output-display}\n![Number of games in summer](05_TT_202203_files/figure-html/summer-1.png){width=576}\n:::\n:::\n\n\nLet us ignore June-August\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nspain_league |>\n  mutate(goals = hgoal+vgoal,\n         month  = month(Date)\n  ) |>\n  # this removes months 6,7 and 8 (June, July, August)\n  #   the exclamation mark (!) means NOT , i.e.\n  # !x means the same as (x == FALSE)  \n  filter(!(month %in% c(6:8))) |>\n  group_by(month) |>\n  # This is how we count nr of rows (matches) per month\n  summarize(number_of_matches = n()) |>\n  ggplot() + \n  geom_point(aes(x=month, y=number_of_matches)) +\n  scale_x_continuous(breaks=1:12)\n```\n\n::: {.cell-output-display}\n![Number of matches without summer](05_TT_202203_files/figure-html/ignore_summer-1.png){width=576}\n:::\n:::\n\n\nHowever, the differences are pretty small. This becomes clear when we set the scale of the Y axis\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nspain_league |>\n  mutate(goals = hgoal+vgoal,\n         month  = month(Date) ) |>\n  filter(!(month %in% c(6:8))) |>\n  group_by(month) |>\n  summarize(mean_goals_pm = mean(goals)) |>\n  ggplot() + \n  geom_point(aes(x=month, y=mean_goals_pm)) +\n  scale_x_continuous(breaks=1:12) + \n  # Y axis range is between 0 and 3 goals\n  ylim(0,3)\n```\n\n::: {.cell-output-display}\n![Mean goals scaled](05_TT_202203_files/figure-html/goals_scaled-1.png){width=576}\n:::\n:::\n\n\nOr as a bar chart\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nspain_league |>\n  mutate(goals = hgoal+vgoal,\n         month  = month(Date) ) |>\n  filter(!(month %in% c(6:8))) |>\n  group_by(month) |>\n  summarize(mean_goals_pm = mean(goals)) |>\n  ggplot() + \n  # geom_col rather than geom_point\n  geom_col(aes(x=month, y=mean_goals_pm)) +\n  scale_x_continuous(breaks=1:12) + \n  # Y axis range is between 0 and 3 goals\n  ylim(0,3)\n```\n\n::: {.cell-output-display}\n![Bar chart of goals](05_TT_202203_files/figure-html/bar_chart-1.png){width=576}\n:::\n:::\n\n\nThe differences are negligible!\n\n3.  Is playing home really an advantage?\n\nLet us create a custom version of the dataset for this analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain_extended <- spain_league |> \n  # Adding '-' in front of a variable means 'throw it away'\n  #   or, in other words, 'do not select it'. If you use the -\n  #   in select, variables not mentioned are retained.\n  select( -Season, -HT, -FT, -tier, -round, -group, -notes ) |>\n  mutate(goals = hgoal+vgoal,\n         year  = year(Date),\n         month  = month(Date),\n         # Continuous version : difference in goals\n         goals_difference = hgoal - vgoal,\n         # Discrete version: home wins, visitors win, equal split\n         result_discrete = case_when(goals_difference > 0  ~ \"Hosts wins\",\n                                     goals_difference < 0  ~ \"Visitors win\",\n                                     goals_difference == 0 ~ \"Equal split\") )\n```\n:::\n\n\nFrequency of wins, losses and equal splits\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain_extended |> count(result_discrete)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  result_discrete     n\n1     Equal split  5644\n2      Hosts wins 13227\n3    Visitors win  4954\n```\n:::\n:::\n\n\nIntermezzo (added after the workshop meeting)\n\nYou may be familiar with the 'classic R' table function to create this table (printed horizontally):\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(spain_extended$result_discrete)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n Equal split   Hosts wins Visitors win \n        5644        13227         4954 \n```\n:::\n:::\n\n\nIf you prefer the classic table, the below will NOT work because there must always be a function after the pipe symbol (`|>`) as the pipe symbol means \"whatever\" is returned by the function before `|>` will become the first argument of the function after the `|>`.And 'result_discrete' is not a function, but an object.\n\n    spain_extended |> result_discrete |> table() \n\nBut this will work, because pull is a function that returns the variable `result_discrete` as a vector):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain_extended |> pull(result_discrete) |> table()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n Equal split   Hosts wins Visitors win \n        5644        13227         4954 \n```\n:::\n:::\n\n\nFrequency table with proportions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain_extended |>\n  group_by(result_discrete) |>\n  summarize(frequency = n()) |>\n  mutate(proportion = frequency / sum(frequency))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 x 3\n  result_discrete frequency proportion\n  <chr>               <int>      <dbl>\n1 Equal split          5644      0.237\n2 Hosts wins          13227      0.555\n3 Visitors win         4954      0.208\n```\n:::\n:::\n\n\nSame thing, but now as a bar chart.\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nspain_extended |>\n  group_by(result_discrete) |>\n  summarize(frequency = n()) |>\n  mutate(proportion = frequency / sum(frequency)) |>\n  ggplot() +\n  geom_col(aes(x=result_discrete, y=proportion), fill=\"blue\")\n```\n\n::: {.cell-output-display}\n![Proportions in a bar chart](05_TT_202203_files/figure-html/proportion_chart-1.png){width=576}\n:::\n:::\n\n\nWhat does goal difference home-visitors look like\n\nKey descriptive variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspain_extended |> \n  select(goals_difference) |> \n  summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n goals_difference\n Min.   :-8.000  \n 1st Qu.: 0.000  \n Median : 1.000  \n Mean   : 0.805  \n 3rd Qu.: 2.000  \n Max.   :11.000  \n```\n:::\n:::\n\n\n`Mean`: On average, home teams score .78 goals more per match than visitors.\\\n`Median`: In half of the matches, the home team scores more than 1 goal more than the visitors\n\nLet us make a box plot\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nspain_extended |> \n  ggplot() + \n  geom_boxplot(aes(x=goals_difference)) + \n  scale_x_continuous(breaks = seq(-10, 10,1))\n```\n\n::: {.cell-output-display}\n![Scores in a box plot](05_TT_202203_files/figure-html/scores_chart-1.png){width=576}\n:::\n:::\n\n\nHome teams clearly have an advantage!\n\n4.  Has this advantage changed over time?\n\nProportions of matches won, lost, equal split\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nspain_extended |>\n  group_by(year, result_discrete) |>\n  summarize(frequency = n()) |>\n  mutate(proportion = frequency / sum(frequency)) |>\n  ggplot() +\n  geom_line(aes(x=year, y=proportion, color=result_discrete))\n```\n\n::: {.cell-output-display}\n![Won, lost and equal in lines](05_TT_202203_files/figure-html/Proportions_line-1.png){width=576}\n:::\n:::\n\n\nGoal count differences between home team and visitors\n\n\n::: {.cell .caption-margin}\n\n```{.r .cell-code}\nspain_extended |>\n  group_by(year) |>\n  summarize(home_visitors_difference = mean(goals_difference)) |>\n  ggplot() +\n  geom_line(aes(x=year, y=home_visitors_difference))\n```\n\n::: {.cell-output-display}\n![Differences between home team and visitors](05_TT_202203_files/figure-html/differenceshome_visitors-1.png){width=576}\n:::\n:::\n\n\nBoth graphs strongly suggest that home advantage decreased over the past century.\n\n## References\n",
    "supporting": [
      "05_TT_202203_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}